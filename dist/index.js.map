{"version":3,"sources":["../src/index.js"],"names":["tableContainer","document","getElementById","form","formInput","querySelector","formInputContainer","addEventListener","event","preventDefault","formData","FormData","chartURL","get","replace","formError","add","hasChildNodes","innerHTML","loader","show","fetch","then","response","hide","status","Error","json","responseJSON","type","tableHTML","createElement","title","subtitle","createTable","appendChild","catch","error","empty","console","warn","loaderHTML","setAttribute","removeChild","errorMessage","classList","remove","data","headers","map","header","join","body","row","cells"],"mappings":"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","file":"index.js","sourcesContent":["\nconst tableContainer = document.getElementById('table-container');\n\nif (tableContainer) {\n    const form = document.getElementById('chart-input-form');\n    const formInput = form.querySelector('input');\n    const formInputContainer = document.querySelector('.form__input');\n    \n     /* BIND EVENTS */\n     form.addEventListener('submit', event => {\n        event.preventDefault();\n        const formData = new FormData(form);\n        const chartURL = formData.get('chart-url').replace(/^(?:\\/\\/|[^\\/]+)*\\//, \"\").replace(\"/data\", \"\");\n\n        if (!chartURL) {\n            formError.add(\"You must enter a chart's URL\");\n            return;\n        }\n        \n        if (tableContainer.hasChildNodes()) {\n            tableContainer.innerHTML = \"\";\n        }\n        \n        loader.show();\n        fetch(`https://www.ons.gov.uk/${chartURL}/data`).then(response => {\n            loader.hide();\n            switch (response.status) {\n                case 400: {\n                    formError.add('An unexpected error occurred. Please check the URL and try again.');\n                    throw Error;\n                }\n                case 404: {\n                    formError.add('This chart could not be found. Please check that the URL is for an ONS chart.');\n                    throw Error;\n                }\n                case 500: {\n                    formError.add('An unexpected error occurred. Please check the URL and try again.');\n                    throw Error;\n                }\n            }\n            return response.json();\n        }).then(responseJSON => {\n            if (!responseJSON.type || responseJSON.type !== \"chart\") {\n                formError.add('URL was for a page that is not an ONS chart.');\n                return;\n            }\n\n            const tableHTML = document.createElement('div');\n            tableHTML.innerHTML = (\n                `<h2>${responseJSON.title}</h2>\n                <p class=\"table-subtitle\">${responseJSON.subtitle}</p>\n                ${createTable(responseJSON)}\n                `\n            );\n            tableContainer.appendChild(tableHTML);\n        }).catch(error => {\n            loader.hide();\n        });\n    });\n\n    formInput.addEventListener('input', () => {\n        formError.empty();\n    });\n\n    /* RE-USABLE DOM INTERACTIONS */\n    class loader {\n        static show() {\n            if (document.getElementById('loader')) {\n                console.warn(\"Attempt to add loader when it is already displayed\");\n                return;\n            }\n            const loaderHTML = document.createElement('div');\n            loaderHTML.setAttribute('id', 'loader');\n            tableContainer.appendChild(loaderHTML);\n        }\n        static hide() {\n            const loader = document.getElementById('loader');\n            if (!loader) {\n                console.warn(\"Attempt to remove loader when it's not being displayed yet\");\n                return;\n            }\n            tableContainer.removeChild(loader);\n        }\n    }\n\n    class formError {\n        static add(errorMessage) {\n            const error = document.createElement('span');\n            error.classList.add('form__error');\n            error.innerHTML = errorMessage;\n            formInputContainer.appendChild(error);\n            formInputContainer.classList.add('form__input--error');\n            \n        }\n        static empty() {\n            const error = document.querySelector('.form__error');\n            if (!error) {\n                return;\n            }\n            formInputContainer.classList.remove('form__input--error');\n            form.querySelector('.form__input').removeChild(error);\n        }\n    }\n}\n\n/* TEMPLATES */\nfunction createTable(data) {\n    const headers = data.headers.map(header => {\n        return (\n            `<th>${header}</th>`\n        )\n    }).join(\"\");\n    const body = data.data.map(row => {\n        const cells = data.headers.map(header => {\n            return (\n                `<td>${row[header]}</td>`\n            )\n        }).join(\"\");\n        return `<tr>${cells}</tr>`;\n    }).join(\"\");\n\n    return (\n        `<div class=\"table-wrapper\">\n        <table>\n            <thead>\n                <tr scope=\"col\">${headers}</tr>\n            </thead>\n            <tbody>\n                ${body}\n            </tbody>\n        </table>\n        </div>`\n     );\n}\n"]}