{"version":3,"sources":["../src/index.js"],"names":["tableContainer","document","getElementById","form","formInput","querySelector","formInputContainer","addEventListener","event","preventDefault","formData","FormData","chartURL","get","replace","formError","add","hasChildNodes","innerHTML","loader","show","fetch","then","response","hide","status","json","responseJSON","type","tableHTML","createElement","title","subtitle","createTable","appendChild","catch","error","console","empty","data","headers","map","header","join","body","row","cells","warn","loaderHTML","setAttribute","removeChild","errorMessage","classList","remove"],"mappings":"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","file":"index.js","sourcesContent":["const tableContainer = document.getElementById('table-container');\nconst form = document.getElementById('chart-input-form');\nconst formInput = form.querySelector('input');\nconst formInputContainer = document.querySelector('.form__input');\n\n/* BIND EVENTS */\nform.addEventListener('submit', event => {\n    event.preventDefault();\n    const formData = new FormData(form);\n    const chartURL = formData.get('chart-url').replace(/^(?:\\/\\/|[^\\/]+)*\\//, \"\").replace(\"/data\", \"\");\n\n    if (!chartURL) {\n        formError.add(\"You must enter a chart's URL\");\n        return;\n    }\n    \n    if (tableContainer.hasChildNodes()) {\n        tableContainer.innerHTML = \"\";\n    }\n    \n    loader.show();\n    fetch(`https://www.ons.gov.uk/${chartURL}/data`).then(response => {\n        loader.hide();\n        switch (response.status) {\n            case 400: {\n                formError.add('An unexpected error occurred. Please check the URL and try again.');\n                return;\n            }\n            case 404: {\n                formError.add('This chart could not be found. Please check that the URL is for an ONS chart.');\n                return;\n            }\n            case 500: {\n                formError.add('An unexpected error occurred. Please check the URL and try again.');\n                return;\n            }\n        }\n        return response.json();\n    }).then(responseJSON => {\n        if (!responseJSON.type || responseJSON.type !== \"chart\") {\n            formError.add('URL was for a page that is not an ONS chart.');\n            return;\n        }\n\n        const tableHTML = document.createElement('div');\n        tableHTML.innerHTML = (\n            `<h2>${responseJSON.title}</h2>\n            <p class=\"table-subtitle\">${responseJSON.subtitle}</p>\n            ${createTable(responseJSON)}\n            `\n        );\n        tableContainer.appendChild(tableHTML);\n    }).catch(error => {\n        loader.hide();\n        console.error(\"An unexpected error occurred whilst trying to fetch chart data\", error);\n    });\n});\n\nformInput.addEventListener('input', () => {\n    formError.empty();\n});\n\n/* TEMPLATES */\nfunction createTable(data) {\n    const headers = data.headers.map(header => {\n        return (\n            `<th>${header}</th>`\n        )\n    }).join(\"\");\n    const body = data.data.map(row => {\n        const cells = data.headers.map(header => {\n            return (\n                `<td>${row[header]}</td>`\n            )\n        }).join(\"\");\n        return `<tr>${cells}</tr>`;\n    }).join(\"\");\n\n    return (\n        `<div class=\"table-wrapper\">\n        <table>\n            <thead>\n                <tr scope=\"col\">${headers}</tr>\n            </thead>\n            <tbody>\n                ${body}\n            </tbody>\n        </table>\n        </div>`\n     );\n    \n}\n\n/* RE-USABLE DOM INTERACTIONS */\nclass loader {\n    static show() {\n        if (document.getElementById('loader')) {\n            console.warn(\"Attempt to add loader when it is already displayed\");\n            return;\n        }\n        const loaderHTML = document.createElement('div');\n        loaderHTML.setAttribute('id', 'loader');\n        tableContainer.appendChild(loaderHTML);\n    }\n    static hide() {\n        const loader = document.getElementById('loader');\n        if (!loader) {\n            console.warn(\"Attempt to remove loader when it's not being displayed yet\");\n            return;\n        }\n        tableContainer.removeChild(loader);\n    }\n}\n\nclass formError {\n    static add(errorMessage) {\n        const error = document.createElement('span');\n        error.classList.add('form__error');\n        error.innerHTML = errorMessage;\n        formInputContainer.appendChild(error);\n        formInputContainer.classList.add('form__input--error');\n        \n    }\n    static empty() {\n        const error = document.querySelector('.form__error');\n        if (!error) {\n            return;\n        }\n        formInputContainer.classList.remove('form__input--error');\n        form.querySelector('.form__input').removeChild(error);\n    }\n}"]}